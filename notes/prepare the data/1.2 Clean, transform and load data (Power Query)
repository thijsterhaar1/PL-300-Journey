# Clean, transform and load data (Power Query) - notes

---

### Step 0 – Setup for 1.2

- Opened my sales/customers model in Power BI Desktop.
- Opened Power Query (Home > Transform data) to work on the queries.

---

### Step 1 – Basic shaping (shape the initial data)

#### What I read
- “Shape the initial data” module: using Power Query to clean up and organize tables.
- Learned about:
  - Using the first row as headers
  - Removing and renaming columns
  - Filtering and sorting rows
  - Applied steps list

#### What I did in Power Query
- Used **Use first row as headers** on my sales table (if needed).
- Removed unnecessary columns.
- Renamed columns to more meaningful names (e.g. Date -> OrderDate).
- Filtered rows (e.g. removed null regions / filtered out specific values).
- Sorted the table by one or more columns.
- Reviewed the **Applied steps** pane to see each transformation.

#### What I learned
- Basic shaping operations (remove/rename/sort/filter) create separate steps in the query.
- I can always click a step to see the state of the data at that point.

---

### Step 2 – Split and merge columns

#### What I did in Power Query
- In the **sales** table:
  - Selected the Region and Product columns and used **Transform > Merge columns**
    - Separator: " - "
    - New column name: Region-Product
  - Then selected Region-Product and used **Transform > Split column > By delimiter**
    - Delimiter: " - "
    - Resulted in two columns which I renamed back to Region and Product.
- Created a small demo table (DemoSplit) with a YearMonth column (e.g. 202401, 202402, 202403).
  - Used **Transform > Split column > By number of characters**
    - Split after 4 characters into Year and Month.

#### What I learned
- **Merge columns** combines multiple text columns into one using a separator.
- **Split column by delimiter** splits a text column into multiple columns based on a character like "-" or ",".
- **Split column by number of characters** splits a text field at a fixed position (e.g. YYYYMM → YYYY + MM).
- Every split/merge operation becomes its own step in the Applied steps list.

---

### Step 3 – Data types, nulls and errors

#### What I did in Power Query
- Reviewed and corrected data types:
  - Dates set to **Date**
  - Quantity to **Whole number**
  - Price/Amount to **Decimal number**
  - Text columns (Product, Region, CustomerName) to **Text**
- Handled null values:
  - Filtered out nulls in one column.
  - Used **Replace values** to replace null/blank values with "Unknown" (or 0).
- Practised working with errors:
  - Forced errors by converting a text column to Whole number.
  - Used **Remove errors** to delete error rows.
  - (Optionally) used **Replace errors** to replace error values.

#### What I learned
- Correct data types are important for calculations and visuals.
- Nulls and errors can break measures if I don’t handle them.
- Each change (type change, filter, replace, remove errors) becomes its own step in Applied steps.

---

### Step 4 – Conditional columns

#### What I did in Power Query
- Opened the **sales** query.
- Used **Add Column > Conditional Column** to create:
  - `OrderSize`:
    - If Quantity > 3 then "Large"
    - Else "Normal"
- (Optional) Created another conditional column based on Region.

#### What I learned
- Conditional columns let me apply simple IF/THEN logic during data preparation.
- The result is a new column that is calculated at refresh time (not a DAX measure).
- The conditional column step appears in the Applied steps list and can be edited later.

---

### Step 5 – Merge and append queries

#### Merge queries (join)
- Used **Home > Merge queries as new** with:
  - First table: sales
  - Second table: customers_pl300
  - Join key: Region (same field in both tables)
  - Join kind: Left Outer (all from sales, matching from customers_pl300)
- Expanded the merged column to bring in customer fields (e.g. CustomerName, Region).
- Renamed the new query to `sales_merged_customers`.

#### Append queries (stack)
- Duplicated the `sales` query and renamed it to `sales_extra`.
- Changed some values in `sales_extra` to simulate additional rows.
- Used **Home > Append queries as new**:
  - Table 1: sales
  - Table 2: sales_extra
- Renamed the result to `sales_all`, which now contains rows from both tables.

#### What I learned
- **Merge** = join tables side by side using a key column (adds columns).
- **Append** = stack tables with the same structure on top of each other (adds rows).
- Both operations create their own steps in the Applied steps list.

---

